# Оптимизация производительности AiChrome

## ⚡ КРИТИЧЕСКИЕ ИЗМЕНЕНИЯ ДЛЯ УСТРАНЕНИЯ ЛАГОВ

### 1. **Приоритет обычного Chrome над Chrome for Testing**
Chrome for Testing содержит отладочную информацию и работает медленнее. Теперь система автоматически использует обычный Chrome из `C:\Program Files\Google\Chrome\Application\chrome.exe` если он установлен.

### 2. **Оптимизировано прокси-расширение** 
Заменено `blocking` на `asyncBlocking` в webRequest API - это устраняет задержки на каждый сетевой запрос (включая автодополнение в поисковой строке).

### 3. **Уменьшено количество процессов**
- Добавлен флаг `--process-per-site` - по одному процессу на сайт вместо процесса на каждую вкладку
- Отключена изоляция сайтов (`--disable-site-isolation-trials`) - меньше процессов

### 4. **Улучшена отзывчивость печати**
- Добавлен флаг `--disable-ipc-flooding-protection` - устраняет задержки при быстрой печати
- Это КРИТИЧНО для устранения лага между печатью и отображением текста

### 5. **Отключены фоновые процессы**
- Синхронизация, автоперевод, обновления, фишинг-детектор и другие ненужные сервисы отключены
- Это уменьшает нагрузку на CPU и память

## Дополнительная оптимизация

### 1. Программный рендеринг (если тормозит GPU)

Установите переменную окружения перед запуском:

```powershell
$env:AICHROME_SOFTGPU = "1"
C:\Python313\python.exe C:\AI\AiChrome\multi_browser_manager.py
```

Это отключит GPU-ускорение и использует программный рендеринг.

### 2. Уменьшение количества процессов

Если всё ещё слишком много процессов, можно вручную уменьшить лимит в `worker_chrome.py`:

Измените строку:
```python
"--renderer-process-limit=4",
```

На:
```python
"--renderer-process-limit=2",  # или даже 1 для минимальной нагрузки
```

### 3. Закрытие лишних вкладок

Chrome создаёт отдельный процесс для каждой вкладки. Держите открытыми только необходимые вкладки.

### 4. Проверка прокси

Медленный прокси может вызывать задержки при вводе. Используйте кнопку "Self-Test" в интерфейсе для проверки скорости прокси.

### 5. Увеличение приоритета процесса (Windows)

В Диспетчере задач:
1. Найдите процесс "Google Chrome for Testing" (основной)
2. ПКМ → Подробнее → Приоритет → Высокий

## Что означают множественные процессы Chrome

Это нормально для Chromium-браузеров. Типичная структура:
- 1 основной процесс браузера
- 1 GPU-процесс
- 1 сетевой процесс
- 1-4 процесса рендеринга (по одному на группу вкладок)
- 1 процесс расширений (если используется прокси-авторизация)

**До оптимизации:** 10+ процессов  
**После оптимизации:** 6-8 процессов

## Troubleshooting

### Браузер всё ещё тормозит

1. Закройте все остальные Chrome/Edge браузеры
2. Проверьте загрузку CPU в Диспетчере задач
3. Попробуйте запустить без прокси для тестирования
4. Включите `AICHROME_SOFTGPU=1` для отключения GPU

### Слишком много памяти

- Уменьшите `--renderer-process-limit` до 2
- Закройте лишние вкладки
- Перезапустите профиль

### Ошибки при запуске

- Проверьте, что рабочий Chrome установлен: кнопка "Установить рабочий Chrome"
- Проверьте наличие свободного места на диске
- Проверьте права доступа к папке `C:\AI\profiles`
